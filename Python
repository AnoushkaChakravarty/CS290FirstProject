import random

SIZE = 5
SHIPS = 3

def create_board():
    return [["~"] * SIZE for _ in range(SIZE)]

def place_ships(board):
    ships = set()
    while len(ships) < SHIPS:
        r = random.randint(0, SIZE - 1)
        c = random.randint(0, SIZE - 1)
        ships.add((r, c))
    return ships

def print_board(board):
    print("  " + " ".join(str(i) for i in range(SIZE)))
    for i, row in enumerate(board):
        print(i, " ".join(row))

def get_neighbors(r, c):
    return [(r+1,c),(r-1,c),(r,c+1),(r,c-1)]

def computer_move_easy(used):
    move = (random.randint(0, SIZE-1), random.randint(0, SIZE-1))
    while move in used:
        move = (random.randint(0, SIZE-1), random.randint(0, SIZE-1))
    return move

def computer_move_hard(used, targets):
    while targets:
        move = targets.pop()
        if move not in used and 0 <= move[0] < SIZE and 0 <= move[1] < SIZE:
            return move
    return computer_move_easy(used)

def play():
    board = create_board()
    player_ships = place_ships(create_board())
    computer_ships = place_ships(create_board())

    used = set()
    targets = []
    mode = input("Choose mode (easy/hard): ").lower()

    while computer_ships and player_ships:
        print_board(board)
        r = int(input("Row: "))
        c = int(input("Col: "))

        if (r, c) in computer_ships:
            print("Hit!")
            board[r][c] = "X"
            computer_ships.remove((r, c))
        else:
            print("Miss!")
            board[r][c] = "O"

        if mode == "hard":
            move = computer_move_hard(used, targets)
        else:
            move = computer_move_easy(used)

        used.add(move)
        if move in player_ships:
            print("Computer hit your ship!")
            player_ships.remove(move)
            if mode == "hard":
                targets.extend(get_neighbors(*move))
        else:
            print("Computer missed!")

    print("You win!" if player_ships else "Computer wins!")

play()
